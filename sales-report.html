<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Satƒ±≈ü Raporlarƒ± - Market Otomasyonu</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root{
      --primary:#0d6efd; --success:#198754; --danger:#dc3545; --warning:#ffc107; --info:#0dcaf0;
      --dark:#212529; --light:#f8f9fa; --muted:#6c757d;
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-success: linear-gradient(135deg, #52c234 0%, #198754 100%);
      --gradient-warning: linear-gradient(135deg, #ffd89b 0%, #ffc107 100%);
    }
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{min-height:100vh}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--gradient-1);
      color:#212529; padding:20px;
    }
    
    /* Modern Header */
    .header-card{
      background:#fff;
      border-radius:16px;
      padding:20px;
      margin-bottom:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }
    .brand{display:flex;gap:15px;align-items:center}
    .logo{
      width:60px;
      height:60px;
      border-radius:16px;
      background:linear-gradient(135deg,#52c234,#198754);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      color:#fff;
      font-weight:bold;
      box-shadow: 0 8px 16px rgba(82, 194, 52, 0.4);
      transition: transform 0.3s ease;
    }
    .logo:hover{transform: scale(1.1) rotate(5deg);}
    h1{font-size:24px;margin:0;font-weight:800;color:#212529;letter-spacing:-0.5px}
    p.lead{margin:4px 0 0 0;color:#6c757d;font-size:13px}
    
    /* Quick Nav Buttons */
    .quick-nav{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}
    .quick-nav .btn{
      border-radius:12px;
      padding:10px 20px;
      font-weight:600;
      transition: all 0.3s ease;
      border:none;
    }
    .quick-nav .btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }
    .btn-success{background:linear-gradient(135deg, #52c234 0%, #198754 100%)}
    .btn-warning{background:linear-gradient(135deg, #ffd89b 0%, #ffc107 100%);color:#212529}
    .btn-primary{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}
    .btn-danger{background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%)}
    .btn-info{background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)}
    
    /* Stats Cards */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:20px;
      margin-bottom:24px;
    }
    .stat-card{
      background:#fff;
      border-radius:20px;
      padding:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.15);
      border:none;
      overflow:hidden;
      transition: all 0.3s ease;
      position:relative;
    }
    .stat-card:hover{
      transform: translateY(-5px);
      box-shadow:0 15px 50px rgba(0,0,0,0.25);
    }
    .stat-card::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:var(--gradient-success);
    }
    .stat-card.today::before{background:var(--gradient-success)}
    .stat-card.month::before{background:var(--gradient-3)}
    .stat-card.year::before{background:var(--gradient-2)}
    .stat-icon{
      width:50px;
      height:50px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      color:#fff;
      margin-bottom:12px;
    }
    .stat-card.today .stat-icon{background:var(--gradient-success)}
    .stat-card.month .stat-icon{background:var(--gradient-3)}
    .stat-card.year .stat-icon{background:var(--gradient-2)}
    .stat-label{
      font-size:13px;
      color:#6c757d;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.5px;
      margin-bottom:8px;
    }
    .stat-value{
      font-size:32px;
      font-weight:900;
      color:#212529;
      line-height:1;
      margin-bottom:4px;
    }
    .stat-subvalue{
      font-size:14px;
      color:#6c757d;
      font-weight:500;
    }
    
    /* Modern Cards */
    .modern-card{
      background:#fff;
      border-radius:20px;
      box-shadow:0 10px 40px rgba(0,0,0,0.15);
      border:none;
      overflow:hidden;
      transition: all 0.3s ease;
      height:100%;
    }
    .modern-card:hover{
      box-shadow:0 15px 50px rgba(0,0,0,0.25);
    }
    .modern-card .card-header{
      border:none;
      padding:20px;
      font-weight:700;
      background:linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
      border-bottom:2px solid #e9ecef;
    }
    .modern-card .card-body{padding:25px}
    
    /* Filter Buttons */
    .filter-buttons{
      display:flex;
      gap:10px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }
    .filter-btn{
      padding:10px 20px;
      border-radius:12px;
      border:2px solid #e9ecef;
      background:#fff;
      color:#6c757d;
      font-weight:600;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    .filter-btn:hover{
      border-color:#667eea;
      color:#667eea;
      transform:translateY(-2px);
    }
    .filter-btn.active{
      background:var(--gradient-1);
      color:#fff;
      border-color:transparent;
    }
    
    /* Calendar Grid */
    .calendar-grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:10px;
      margin-top:20px;
    }
    .day-card{
      background:#fff;
      border-radius:12px;
      padding:12px;
      text-align:center;
      border:2px solid #e9ecef;
      cursor:pointer;
      transition: all 0.3s ease;
      min-height:80px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .day-card:hover{
      transform:scale(1.05);
      box-shadow:0 8px 25px rgba(102, 126, 234, 0.3);
      border-color:#667eea;
    }
    .day-card.has-sales{
      background:linear-gradient(135deg, #f8f9fa 0%, #e7f3ff 100%);
      border-color:#0d6efd;
    }
    .day-card.selected{
      background:var(--gradient-success);
      color:#fff;
      border-color:transparent;
    }
    .day-number{
      font-size:20px;
      font-weight:800;
      margin-bottom:4px;
    }
    .day-sales{
      font-size:12px;
      font-weight:600;
      color:#198754;
    }
    .day-card.selected .day-sales{
      color:#fff;
    }
    
    /* Sales List */
    .sales-list{
      max-height:500px;
      overflow-y:auto;
    }
    .sale-item{
      background:linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
      border-left:4px solid #52c234;
      transition: all 0.3s ease;
      animation: slideInRight 0.3s ease;
    }
    .sale-item:hover{
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .sale-time{
      font-size:12px;
      color:#6c757d;
      font-weight:600;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .sale-products{
      margin-bottom:8px;
    }
    .product-line{
      padding:6px 0;
      border-bottom:1px solid #e9ecef;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:14px;
    }
    .product-line:last-child{
      border-bottom:none;
    }
    .product-name{
      font-weight:600;
      color:#212529;
    }
    .product-qty{
      color:#6c757d;
      font-size:13px;
    }
    .product-price{
      color:#198754;
      font-weight:700;
    }
    .sale-total{
      text-align:right;
      padding-top:8px;
      border-top:2px solid #e9ecef;
      margin-top:8px;
    }
    .sale-total-label{
      font-size:13px;
      color:#6c757d;
      font-weight:600;
    }
    .sale-total-value{
      font-size:20px;
      font-weight:900;
      color:#198754;
    }
    
    /* Empty State */
    .empty-state{
      text-align:center;
      padding:60px 20px;
      color:#6c757d;
    }
    .empty-state i{
      font-size:64px;
      opacity:0.3;
      margin-bottom:20px;
    }
    
    /* Animations */
    @keyframes slideInRight {
      from {opacity: 0; transform: translateX(-20px)}
      to {opacity: 1; transform: translateX(0)}
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    
    /* Form Styling */
    .form-control, .form-select{
      border-radius:12px;
      border:2px solid #e9ecef;
      padding:12px 16px;
      transition: all 0.3s ease;
      font-size:15px;
    }
    .form-control:focus, .form-select:focus{
      border-color:#667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {width: 8px; height: 8px}
    ::-webkit-scrollbar-track {background: #f1f1f1; border-radius: 10px}
    ::-webkit-scrollbar-thumb {background: #667eea; border-radius: 10px}
    ::-webkit-scrollbar-thumb:hover {background: #764ba2}
    
    /* Responsive */
    @media (max-width:768px){
      body{padding:12px}
      h1{font-size:20px}
      .stats-grid{grid-template-columns:1fr;gap:12px}
      .calendar-grid{grid-template-columns:repeat(4,1fr);gap:8px}
      .day-card{min-height:70px;padding:8px}
      .day-number{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="header-card">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div class="brand">
          <div class="logo"><i class="bi bi-graph-up-arrow"></i></div>
          <div>
            <h1>Satƒ±≈ü Raporlarƒ±</h1>
            <p class="lead">Detaylƒ± satƒ±≈ü analizleri ve gelir raporlarƒ±</p>
          </div>
        </div>
      </div>
      <!-- Quick Navigation -->
      <div class="quick-nav">
        <a href="index.html" class="btn btn-primary">
          <i class="bi bi-cart-check-fill"></i> Ana Sayfa
        </a>
        <a href="add-product.html" class="btn btn-success">
          <i class="bi bi-plus-circle-fill"></i> Yeni √úr√ºn
        </a>
        <a href="categories.html" class="btn btn-info">
          <i class="bi bi-bookmarks-fill"></i> Kategoriler
        </a>
        <a href="credit-sales.html" class="btn btn-warning text-dark">
          <i class="bi bi-cash-coin"></i> Veresiyeler
        </a>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="alert alert-light d-flex justify-content-between align-items-center mb-3">
      <div>
        <i class="bi bi-info-circle-fill text-primary"></i>
        <small class="text-muted">Son g√ºncelleme: <strong id="lastUpdate">Y√ºkleniyor...</strong></small>
      </div>
      <small class="text-muted">Otomatik yenileme: 30 saniye</small>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card today">
        <div class="stat-icon"><i class="bi bi-calendar-day"></i></div>
        <div class="stat-label">Bug√ºn</div>
        <div class="stat-value" id="todayTotal">0.00 ‚Ç∫</div>
        <div class="stat-subvalue"><span id="todaySales">0</span> satƒ±≈ü</div>
      </div>
      <div class="stat-card month">
        <div class="stat-icon"><i class="bi bi-calendar-month"></i></div>
        <div class="stat-label">Bu Ay</div>
        <div class="stat-value" id="monthTotal">0.00 ‚Ç∫</div>
        <div class="stat-subvalue"><span id="monthSales">0</span> satƒ±≈ü</div>
      </div>
      <div class="stat-card year">
        <div class="stat-icon"><i class="bi bi-calendar-week"></i></div>
        <div class="stat-label">Bu Hafta</div>
        <div class="stat-value" id="yearTotal">0.00 ‚Ç∫</div>
        <div class="stat-subvalue"><span id="yearSales">0</span> satƒ±≈ü</div>
      </div>
      <div class="stat-card" style="border-top:4px solid #ffc107">
        <div class="stat-icon" style="background:var(--gradient-warning)"><i class="bi bi-box-seam"></i></div>
        <div class="stat-label">En √áok Satan</div>
        <div class="stat-value" id="topProductName" style="font-size:18px">-</div>
        <div class="stat-subvalue"><span id="topProductCount">0</span> adet</div>
      </div>
    </div>

    <div class="row g-3">
      <!-- Sol Panel: Takvim -->
      <div class="col-lg-5">
        <div class="modern-card">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0"><i class="bi bi-calendar3"></i> Satƒ±≈ü Takvimi</h6>
            </div>
          </div>
          <div class="card-body">
            <div class="d-flex gap-2 mb-3 align-items-center">
              <select id="monthSelect" class="form-select" style="flex:1">
                <!-- JavaScript ile doldurulacak -->
              </select>
              <select id="yearSelect" class="form-select" style="width:120px">
                <!-- JavaScript ile doldurulacak -->
              </select>
            </div>
            
            <div class="text-center mb-3">
              <h5 class="fw-bold mb-1" id="selectedMonthLabel"></h5>
              <p class="text-muted small mb-0">Satƒ±≈ü olan g√ºnlere tƒ±klayƒ±n</p>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
              <!-- JavaScript ile doldurulacak -->
            </div>
          </div>
        </div>
      </div>

      <!-- Saƒü Panel: Satƒ±≈ü Detaylarƒ± -->
      <div class="col-lg-7">
        <div class="modern-card">
          <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0"><i class="bi bi-receipt"></i> Satƒ±≈ü Detaylarƒ±</h6>
              <div class="d-flex gap-2 align-items-center">
                <button id="refreshBtn" class="btn btn-sm btn-light" title="Verileri Yenile">
                  <i class="bi bi-arrow-clockwise"></i>
                </button>
                <span class="badge bg-light text-dark" id="selectedDateBadge">Bug√ºn</span>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="filter-buttons">
              <button class="filter-btn active" data-filter="day" id="filterDay">
                <i class="bi bi-calendar-day"></i> G√ºnl√ºk
              </button>
              <button class="filter-btn" data-filter="month" id="filterMonth">
                <i class="bi bi-calendar-month"></i> Aylƒ±k
              </button>
              <button class="filter-btn" data-filter="week" id="filterWeek">
                <i class="bi bi-calendar-week"></i> Haftalƒ±k
              </button>
            </div>
            
            <div class="alert alert-info d-flex align-items-center mb-3">
              <i class="bi bi-info-circle-fill me-2"></i>
              <small id="filterInfo">Se√ßilen g√ºne ait satƒ±≈ülar g√∂steriliyor</small>
            </div>
            
            <div id="salesList" class="sales-list">
              <!-- JavaScript ile doldurulacak -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Global deƒüi≈ükenler
    let allSalesData = {}; // {monthYear: {day: [sales]}}
    let selectedDate = new Date();
    let currentFilter = 'day';
    let isDataLoaded = false;

    // Ay isimleri
    const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                        'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];

    // Sayfa y√ºklendiƒüinde
    document.addEventListener('DOMContentLoaded', async () => {
      await loadAllSales();
      initializeSelectors();
      updateCalendar();
      updateStats();
      updateSalesList();
      setupFilterButtons();
      
      // Her 30 saniyede bir verileri yenile
      setInterval(async () => {
        console.log('üîÑ Satƒ±≈ü verileri yenileniyor...');
        await loadAllSales();
        updateCalendar();
        updateStats();
        updateSalesList();
      }, 30000); // 30 saniye
    });

    // T√ºm satƒ±≈ülarƒ± y√ºkle
    async function loadAllSales() {
      try {
        // API varsa kullan
        try {
          const apiResponse = await fetch('api.php?action=getSales');
          if (apiResponse.ok) {
            const result = await apiResponse.json();
            if (result.success) {
              allSalesData = result.data;
              console.log('‚úÖ Satƒ±≈ü verileri API\'den y√ºklendi:', allSalesData);
              return;
            }
          }
        } catch (apiError) {
          console.log('‚ö†Ô∏è API mevcut deƒüil, dosyalardan y√ºklenecek');
        }

        // API yoksa dosyalardan y√ºkle - optimize edilmi≈ü versiyon
        const currentYear = new Date().getFullYear();
        const currentMonth = new Date().getMonth() + 1;
        
        // Son 3 ay ve sonraki 1 ay (toplamda 4 ay)
        const monthsToLoad = [];
        for (let i = -2; i <= 1; i++) {
          let month = currentMonth + i;
          let year = currentYear;
          
          if (month <= 0) {
            month += 12;
            year--;
          } else if (month > 12) {
            month -= 12;
            year++;
          }
          
          monthsToLoad.push({
            monthYear: String(month).padStart(2, '0') + '-' + year,
            month,
            year
          });
        }

        console.log('üìÖ Y√ºklenecek aylar:', monthsToLoad.map(m => m.monthYear));

        // Her ay i√ßin g√ºnl√ºk dosyalarƒ± y√ºkle - paralel olarak
        const allPromises = [];
        
        for (const {monthYear, month, year} of monthsToLoad) {
          const daysInMonth = new Date(year, month, 0).getDate();
          
          for (let day = 1; day <= daysInMonth; day++) {
            const dayStr = String(day).padStart(2, '0');
            const url = `purchases/${monthYear}/${dayStr}.json`;
            
            // Her dosya i√ßin bir promise olu≈ütur
            allPromises.push(
              fetch(url)
                .then(response => {
                  if (response.ok) {
                    return response.json().then(data => ({
                      monthYear,
                      dayStr,
                      data,
                      success: true
                    }));
                  }
                  return { success: false };
                })
                .catch(() => ({ success: false }))
            );
          }
        }

        console.log(`üîç ${allPromises.length} dosya kontrol ediliyor...`);
        
        // T√ºm istekleri paralel √ßalƒ±≈ütƒ±r
        const results = await Promise.all(allPromises);
        
        // Ba≈üarƒ±lƒ± sonu√ßlarƒ± i≈üle
        let loadedCount = 0;
        results.forEach(result => {
          if (result.success) {
            if (!allSalesData[result.monthYear]) {
              allSalesData[result.monthYear] = {};
            }
            allSalesData[result.monthYear][result.dayStr] = result.data;
            loadedCount++;
            console.log(`‚úÖ Y√ºklendi: ${result.monthYear}/${result.dayStr}.json - ${result.data.length} satƒ±≈ü`);
          }
        });

        console.log(`‚úÖ Satƒ±≈ü verileri dosyalardan y√ºklendi: ${loadedCount} dosya, ${Object.keys(allSalesData).length} ay`);
        isDataLoaded = Object.keys(allSalesData).length > 0;
      } catch (error) {
        console.error('‚ùå Satƒ±≈ü verileri y√ºklenirken hata:', error);
        allSalesData = {};
        isDataLoaded = false;
      }
      
      // Eƒüer veri y√ºklenemediyse kullanƒ±cƒ±yƒ± bilgilendir
      if (!isDataLoaded && Object.keys(allSalesData).length === 0) {
        console.error('‚ö†Ô∏è UYARI: Hi√ß satƒ±≈ü verisi y√ºklenemedi!');
        console.error('üìå Olasƒ± nedenler:');
        console.error('   1. Web sunucusu √ßalƒ±≈ümƒ±yor (file:// protokol√º CORS hatasƒ± verir)');
        console.error('   2. purchases/ klas√∂r√º bo≈ü veya eri≈üilemiyor');
        console.error('   3. JSON dosyalarƒ± hatalƒ± formatta');
        console.error('üí° √á√∂z√ºm: PHP sunucusu ba≈ülatƒ±n: php -S localhost:8000');
        
        // Kullanƒ±cƒ±ya g√∂rsel uyarƒ± g√∂ster
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-warning position-fixed top-0 start-50 translate-middle-x mt-3';
        alertDiv.style.zIndex = '9999';
        alertDiv.style.maxWidth = '600px';
        alertDiv.innerHTML = `
          <h6><i class="bi bi-exclamation-triangle-fill"></i> Veriler Y√ºklenemedi!</h6>
          <p class="mb-2 small">Satƒ±≈ü verileri y√ºklenemedi. L√ºtfen bir web sunucusu √ßalƒ±≈ütƒ±rƒ±n:</p>
          <code class="small">cd /home/erdemskywalker/Documents/soft && php -S localhost:8000</code>
          <p class="mt-2 mb-0 small">veya VS Code Live Server eklentisini kullanƒ±n.</p>
        `;
        document.body.appendChild(alertDiv);
        
        setTimeout(() => alertDiv.remove(), 10000);
      }
    }

    // Se√ßicileri ba≈ülat
    function initializeSelectors() {
      const monthSelect = document.getElementById('monthSelect');
      const yearSelect = document.getElementById('yearSelect');
      
      // Aylarƒ± doldur
      monthNames.forEach((name, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = name;
        monthSelect.appendChild(option);
      });
      
      // Yƒ±llarƒ± doldur (2020'den bug√ºne)
      const currentYear = new Date().getFullYear();
      for (let year = currentYear; year >= 2020; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
      
      // Bug√ºn√ºn tarihini se√ß
      monthSelect.value = selectedDate.getMonth();
      yearSelect.value = selectedDate.getFullYear();
      
      // Event listeners
      monthSelect.addEventListener('change', () => {
        selectedDate.setMonth(parseInt(monthSelect.value));
        updateCalendar();
        updateSalesList();
        updateStats();
      });
      
      yearSelect.addEventListener('change', () => {
        selectedDate.setFullYear(parseInt(yearSelect.value));
        updateCalendar();
        updateSalesList();
        updateStats();
      });
    }

    // Takvimi g√ºncelle
    function updateCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      const selectedMonthLabel = document.getElementById('selectedMonthLabel');
      
      const month = selectedDate.getMonth();
      const year = selectedDate.getFullYear();
      const monthYear = String(month + 1).padStart(2, '0') + '-' + year;
      
      selectedMonthLabel.textContent = `${monthNames[month]} ${year}`;
      
      // Ayƒ±n g√ºn sayƒ±sƒ±
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      calendarGrid.innerHTML = '';
      
      // Her g√ºn i√ßin kart olu≈ütur
      for (let day = 1; day <= daysInMonth; day++) {
        const dayStr = String(day).padStart(2, '0');
        const hasSales = allSalesData[monthYear] && allSalesData[monthYear][dayStr];
        const isToday = (day === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear());
        const isSelected = (day === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear());
        
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card';
        if (hasSales) dayCard.classList.add('has-sales');
        if (isSelected) dayCard.classList.add('selected');
        
        let totalAmount = 0;
        let salesCount = 0;
        if (hasSales) {
          const daySales = allSalesData[monthYear][dayStr];
          salesCount = daySales.length;
          totalAmount = daySales.reduce((sum, sale) => sum + sale.total, 0);
        }
        
        dayCard.innerHTML = `
          <div class="day-number">${day}</div>
          ${hasSales ? `<div class="day-sales">${salesCount} satƒ±≈ü<br>${totalAmount.toFixed(2)} ‚Ç∫</div>` : ''}
        `;
        
        dayCard.addEventListener('click', () => {
          selectedDate.setDate(day);
          currentFilter = 'day';
          updateCalendar();
          updateSalesList();
          updateFilterButtons();
          updateStats();
        });
        
        calendarGrid.appendChild(dayCard);
      }
    }

    // ƒ∞statistikleri g√ºncelle
    function updateStats() {
      const now = new Date();
      const today = {
        day: String(now.getDate()).padStart(2, '0'),
        month: String(now.getMonth() + 1).padStart(2, '0'),
        year: String(now.getFullYear())
      };
      
      // Bu haftanƒ±n ba≈ülangƒ±√ß ve biti≈ü tarihlerini hesapla
      const weekStart = new Date(now);
      weekStart.setHours(0, 0, 0, 0);
      weekStart.setDate(now.getDate() - now.getDay() + 1); // Pazartesi
      
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekStart.getDate() + 6); // Pazar
      weekEnd.setHours(23, 59, 59, 999);
      
      let todayTotal = 0, todayCount = 0;
      let monthTotal = 0, monthCount = 0;
      let weekTotal = 0, weekCount = 0;
      let productStats = {};
      
      // T√ºm satƒ±≈ülarƒ± tara
      Object.keys(allSalesData).forEach(monthYear => {
        const [month, year] = monthYear.split('-');
        
        Object.keys(allSalesData[monthYear]).forEach(day => {
          const sales = allSalesData[monthYear][day];
          
          // Bu g√ºn√ºn tarihini olu≈ütur
          const saleDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
          
          sales.forEach(sale => {
            const saleTotal = sale.total || 0;
            
            // √úr√ºn istatistikleri
            sale.items.forEach(item => {
              if (!productStats[item.name]) {
                productStats[item.name] = 0;
              }
              productStats[item.name] += item.qty;
            });
            
            // Bug√ºn
            if (day === today.day && month === today.month && year === today.year) {
              todayTotal += saleTotal;
              todayCount++;
            }
            
            // Bu ay
            if (month === today.month && year === today.year) {
              monthTotal += saleTotal;
              monthCount++;
            }
            
            // Bu hafta (Pazartesi - Pazar)
            if (saleDate >= weekStart && saleDate <= weekEnd) {
              weekTotal += saleTotal;
              weekCount++;
            }
          });
        });
      });
      
      // G√ºncellemeleri yap
      document.getElementById('todayTotal').textContent = todayTotal.toFixed(2) + ' ‚Ç∫';
      document.getElementById('todaySales').textContent = todayCount;
      
      document.getElementById('monthTotal').textContent = monthTotal.toFixed(2) + ' ‚Ç∫';
      document.getElementById('monthSales').textContent = monthCount;
      
      document.getElementById('yearTotal').textContent = weekTotal.toFixed(2) + ' ‚Ç∫';
      document.getElementById('yearSales').textContent = weekCount;
      
      // En √ßok satan √ºr√ºn
      let topProduct = null;
      let topCount = 0;
      Object.keys(productStats).forEach(product => {
        if (productStats[product] > topCount) {
          topCount = productStats[product];
          topProduct = product;
        }
      });
      
      document.getElementById('topProductName').textContent = topProduct || '-';
      document.getElementById('topProductCount').textContent = topCount;
      
      // Son g√ºncelleme zamanƒ±nƒ± g√∂ster
      const lastUpdateEl = document.getElementById('lastUpdate');
      if (lastUpdateEl) {
        lastUpdateEl.textContent = new Date().toLocaleTimeString('tr-TR');
      }
    }

    // Satƒ±≈ü listesini g√ºncelle
    function updateSalesList() {
      const salesList = document.getElementById('salesList');
      const selectedDateBadge = document.getElementById('selectedDateBadge');
      const filterInfo = document.getElementById('filterInfo');
      
      salesList.innerHTML = '';
      
      const day = String(selectedDate.getDate()).padStart(2, '0');
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const year = selectedDate.getFullYear();
      const monthYear = month + '-' + year;
      
      let salesToShow = [];
      
      if (currentFilter === 'day') {
        // G√ºnl√ºk
        selectedDateBadge.textContent = `${day} ${monthNames[selectedDate.getMonth()]} ${year}`;
        filterInfo.textContent = 'Se√ßilen g√ºne ait satƒ±≈ülar g√∂steriliyor';
        
        if (allSalesData[monthYear] && allSalesData[monthYear][day]) {
          salesToShow = allSalesData[monthYear][day];
        }
      } else if (currentFilter === 'month') {
        // Aylƒ±k
        selectedDateBadge.textContent = `${monthNames[selectedDate.getMonth()]} ${year}`;
        filterInfo.textContent = 'Se√ßilen aya ait t√ºm satƒ±≈ülar g√∂steriliyor';
        
        if (allSalesData[monthYear]) {
          Object.keys(allSalesData[monthYear]).forEach(d => {
            salesToShow = salesToShow.concat(allSalesData[monthYear][d]);
          });
        }
      } else if (currentFilter === 'week') {
        // Haftalƒ±k
        const now = new Date(selectedDate);
        const weekStart = new Date(now);
        weekStart.setHours(0, 0, 0, 0);
        weekStart.setDate(now.getDate() - now.getDay() + 1); // Pazartesi
        
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6); // Pazar
        weekEnd.setHours(23, 59, 59, 999);
        
        selectedDateBadge.textContent = `${weekStart.getDate()} ${monthNames[weekStart.getMonth()]} - ${weekEnd.getDate()} ${monthNames[weekEnd.getMonth()]} ${year}`;
        filterInfo.textContent = 'Se√ßilen haftaya ait t√ºm satƒ±≈ülar g√∂steriliyor (Pazartesi-Pazar)';
        
        // Hafta i√ßindeki t√ºm g√ºnleri tara
        Object.keys(allSalesData).forEach(my => {
          const [m, y] = my.split('-');
          
          Object.keys(allSalesData[my]).forEach(d => {
            const saleDate = new Date(parseInt(y), parseInt(m) - 1, parseInt(d));
            
            if (saleDate >= weekStart && saleDate <= weekEnd) {
              salesToShow = salesToShow.concat(allSalesData[my][d]);
            }
          });
        });
      }
      
      // Satƒ±≈ülarƒ± tarihe g√∂re sƒ±rala (en yeni √∂nce)
      salesToShow.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      if (salesToShow.length === 0) {
        salesList.innerHTML = `
          <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <h6>Satƒ±≈ü bulunamadƒ±</h6>
            <p class="small">Se√ßilen ${currentFilter === 'day' ? 'g√ºnde' : currentFilter === 'month' ? 'ayda' : 'haftada'} hen√ºz satƒ±≈ü yapƒ±lmamƒ±≈ü.</p>
          </div>
        `;
        return;
      }
      
      // Satƒ±≈ülarƒ± listele
      salesToShow.forEach((sale, index) => {
        const saleItem = document.createElement('div');
        saleItem.className = 'sale-item';
        saleItem.style.animationDelay = `${index * 0.05}s`;
        
        const productsHTML = sale.items.map(item => `
          <div class="product-line">
            <div>
              <span class="product-name">${item.name}</span>
              <span class="product-qty ms-2">x${item.qty}</span>
            </div>
            <span class="product-price">${item.total.toFixed(2)} ‚Ç∫</span>
          </div>
        `).join('');
        
        saleItem.innerHTML = `
          <div class="sale-time">
            <i class="bi bi-clock"></i>
            ${new Date(sale.timestamp).toLocaleString('tr-TR')}
          </div>
          <div class="sale-products">
            ${productsHTML}
          </div>
          <div class="sale-total">
            <span class="sale-total-label">Toplam: </span>
            <span class="sale-total-value">${sale.total.toFixed(2)} ‚Ç∫</span>
          </div>
        `;
        
        salesList.appendChild(saleItem);
      });
    }

    // Filtre butonlarƒ±nƒ± ayarla
    function setupFilterButtons() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const filter = btn.dataset.filter;
          currentFilter = filter;
          updateFilterButtons();
          updateSalesList();
          updateStats();
        });
      });
    }

    // Filtre butonlarƒ±nƒ± g√ºncelle
    function updateFilterButtons() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      filterButtons.forEach(btn => {
        if (btn.dataset.filter === currentFilter) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // Manuel yenileme butonu
    document.addEventListener('DOMContentLoaded', () => {
      const refreshBtn = document.getElementById('refreshBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', async () => {
          refreshBtn.disabled = true;
          refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> <span class="spinner-border spinner-border-sm" role="status"></span>';
          
          await loadAllSales();
          updateCalendar();
          updateStats();
          updateSalesList();
          
          refreshBtn.disabled = false;
          refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise"></i>';
          
          // Ba≈üarƒ± feedback'i
          const originalHTML = refreshBtn.innerHTML;
          refreshBtn.innerHTML = '<i class="bi bi-check-lg"></i>';
          setTimeout(() => {
            refreshBtn.innerHTML = originalHTML;
          }, 1000);
        });
      }
    });

    // Logging
    console.log('%cüìä Satƒ±≈ü Raporlarƒ± Sayfasƒ±', 'color: #52c234; font-size: 18px; font-weight: bold;');
    console.log('%c‚ú® Modern analiz paneli aktif!', 'color: #0dcaf0; font-size: 14px;');
    console.log('%cüîÑ Otomatik yenileme: 30 saniye', 'color: #ffc107; font-size: 12px;');
  </script>
</body>
</html>
