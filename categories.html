<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kategori YÃ¶netimi - Market Ã–deme Otomasyonu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root{
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{min-height:100vh}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--gradient-1);
      color:#212529; padding:20px;
    }
    
    .header-card{
      background:#fff;
      border-radius:16px;
      padding:20px;
      margin-bottom:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.2);
    }
    .brand{display:flex;gap:15px;align-items:center}
    .logo{
      width:60px;
      height:60px;
      border-radius:16px;
      background:var(--gradient-info);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      color:#fff;
      font-weight:bold;
      box-shadow: 0 8px 16px rgba(79, 172, 254, 0.4);
      transition: transform 0.3s ease;
    }
    .logo:hover{transform: scale(1.1) rotate(-5deg);}
    h1{font-size:24px;margin:0;font-weight:800;color:#212529;}
    p.lead{margin:4px 0 0 0;color:#6c757d;font-size:13px}
    
    .nav-buttons{display:flex;gap:10px;flex-wrap:wrap}
    .nav-buttons .btn{
      border-radius:12px;
      padding:10px 20px;
      font-weight:600;
      transition: all 0.3s ease;
    }
    .nav-buttons .btn:hover{transform: translateY(-2px);box-shadow: 0 6px 20px rgba(0,0,0,0.2)}
    
    .modern-card{
      background:#fff;
      border-radius:20px;
      box-shadow:0 10px 40px rgba(0,0,0,0.15);
      border:none;
      overflow:hidden;
      transition: all 0.3s ease;
    }
    .modern-card:hover{box-shadow:0 15px 50px rgba(0,0,0,0.25)}
    .modern-card .card-header{
      border:none;
      padding:20px;
      font-weight:700;
    }
    .modern-card .card-body{padding:30px}
    
    .category-card{
      cursor:pointer;
      transition: all 0.3s ease;
      border: 2px solid #e9ecef;
      border-radius:12px;
      margin-bottom:12px;
      background:#fff;
      padding:15px;
    }
    .category-card:hover{
      transform: translateX(5px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border-color: #4facfe;
    }
    .category-card.selected{
      border-color: #0dcaf0;
      background: linear-gradient(135deg, #e6f9ff 0%, #fff 100%);
      box-shadow: 0 6px 25px rgba(13, 202, 240, 0.3);
      transform: translateX(8px);
    }
    
    .form-label{
      font-weight:700;
      color:#212529;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .form-control, .form-select{
      border-radius:12px;
      border:2px solid #e9ecef;
      padding:12px 16px;
      transition: all 0.3s ease;
    }
    .form-control:focus, .form-select:focus{
      border-color:#4facfe;
      box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.1);
      transform: scale(1.01);
    }
    
    .btn{
      border-radius:12px;
      padding:12px 24px;
      font-weight:600;
      transition: all 0.3s ease;
      border:none;
    }
    .btn:hover{transform: translateY(-2px);box-shadow: 0 6px 20px rgba(0,0,0,0.2)}
    .btn-primary{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}
    .btn-success{background:linear-gradient(135deg, #52c234 0%, #198754 100%)}
    .btn-info{background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)}
    .btn-danger{background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%)}
    .btn-warning{background:linear-gradient(135deg, #ffd89b 0%, #ffc107 100%);color:#212529}
    
    .alert{
      border-radius:12px;
      border:none;
      padding:16px 20px;
      animation: slideInDown 0.3s ease;
    }
    @keyframes slideInDown {
      from {opacity: 0; transform: translateY(-20px)}
      to {opacity: 1; transform: translateY(0)}
    }
    
    .badge{padding:6px 12px;border-radius:8px;font-weight:600}
    
    .icon-picker{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(50px,1fr));
      gap:8px;
      max-height:200px;
      overflow-y:auto;
      padding:10px;
      background:#f8f9fa;
      border-radius:8px;
    }
    .icon-option{
      width:50px;
      height:50px;
      border:2px solid #dee2e6;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:all 0.2s;
      background:#fff;
    }
    .icon-option:hover{border-color:#4facfe;transform:scale(1.1)}
    .icon-option.selected{border-color:#0dcaf0;background:#e6f9ff;border-width:3px}
    
    .color-picker{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(40px,1fr));
      gap:8px;
      padding:10px;
      background:#f8f9fa;
      border-radius:8px;
    }
    .color-option{
      width:40px;
      height:40px;
      border:3px solid #fff;
      border-radius:50%;
      cursor:pointer;
      transition:all 0.2s;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }
    .color-option:hover{transform:scale(1.15)}
    .color-option.selected{border-color:#212529;transform:scale(1.2);box-shadow:0 4px 12px rgba(0,0,0,0.3)}
    
    @media (max-width:768px){
      body{padding:12px}
      h1{font-size:20px}
      .nav-buttons{width:100%;margin-top:15px}
      .nav-buttons .btn{flex:1}
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="header-card">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div class="brand">
          <div class="logo"><i class="bi bi-bookmarks-fill"></i></div>
          <div>
            <h1>Kategori YÃ¶netimi</h1>
            <p class="lead">ÃœrÃ¼n kategorilerini ekleyin, dÃ¼zenleyin ve yÃ¶netin</p>
          </div>
        </div>
        <div class="nav-buttons">
          <a href="index.html" class="btn btn-primary">
            <i class="bi bi-house-fill"></i> Ana Sayfa
          </a>
          <a href="add-product.html" class="btn btn-outline-success">
            <i class="bi bi-plus-circle-fill"></i> ÃœrÃ¼n Ekle
          </a>
          <a href="sales-report.html" class="btn btn-outline-success">
            <i class="bi bi-graph-up-arrow"></i> SatÄ±ÅŸ RaporlarÄ±
          </a>
          <a href="credit-sales.html" class="btn btn-outline-warning">
            <i class="bi bi-cash-coin"></i> Veresiyeler
          </a>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Sol Panel: Kategori Listesi -->
      <div class="col-lg-5">
        <div class="modern-card card">
          <div class="card-header text-white" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-list-ul"></i> Kategoriler</h5>
              <span class="badge bg-light text-dark fs-6">
                <i class="bi bi-bookmarks"></i> <span id="categoryCount">0</span>
              </span>
            </div>
          </div>
          <div class="card-body">
            <div class="alert alert-info">
              <i class="bi bi-info-circle-fill"></i> <small>DÃ¼zenlemek iÃ§in bir kategoriye tÄ±klayÄ±n</small>
            </div>
            
            <div id="categoryList" style="max-height:600px;overflow-y:auto"></div>
          </div>
        </div>
      </div>

      <!-- SaÄŸ Panel: Kategori Formu -->
      <div class="col-lg-7">
        <div class="modern-card card">
          <div class="card-header text-dark" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">
            <h5 class="mb-0 text-white"><i class="bi bi-plus-circle-fill"></i> <span id="formTitle">Yeni Kategori Ekle</span></h5>
          </div>
          <div class="card-body">
            <div id="alertContainer"></div>

            <form id="categoryForm">
              <input type="hidden" id="editId">
              
              <div class="mb-4">
                <label for="categoryName" class="form-label">
                  <i class="bi bi-tag-fill"></i> Kategori AdÄ±
                </label>
                <input type="text" class="form-control form-control-lg" id="categoryName" 
                       placeholder="Ã–rn: GÄ±da, Ä°Ã§ecek, Temizlik..." required>
              </div>

              <div class="mb-4">
                <label class="form-label"><i class="bi bi-palette-fill"></i> Ä°kon SeÃ§in</label>
                <div class="icon-picker" id="iconPicker"></div>
                <input type="hidden" id="categoryIcon" value="bi-tag-fill">
              </div>

              <div class="mb-4">
                <label class="form-label"><i class="bi bi-palette2"></i> Renk SeÃ§in</label>
                <div class="color-picker" id="colorPicker"></div>
                <input type="hidden" id="categoryColor" value="#667eea">
              </div>

              <div class="mb-4 p-3 border rounded" style="background:#f8f9fa">
                <label class="form-label"><i class="bi bi-eye-fill"></i> Ã–nizleme</label>
                <div class="text-center">
                  <span id="previewBadge" class="badge fs-5" style="background-color:#667eea">
                    <i class="bi-tag-fill"></i> Kategori AdÄ±
                  </span>
                </div>
              </div>

              <div class="d-grid gap-3">
                <button type="submit" class="btn btn-success btn-lg" id="saveBtn">
                  <i class="bi bi-check-circle-fill"></i> Kaydet
                </button>
                <button type="button" id="deleteBtn" class="btn btn-danger" style="display:none">
                  <i class="bi bi-trash-fill"></i> Kategoriyi Sil
                </button>
                <button type="button" id="cancelBtn" class="btn btn-outline-secondary">
                  <i class="bi bi-x-circle"></i> Ä°ptal / Yeni Kategori
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let categories = [];
    let selectedCategoryId = null;

    const icons = [
      'bi-tag-fill', 'bi-basket-fill', 'bi-cup-straw', 'bi-droplet-fill', 
      'bi-heart-fill', 'bi-egg-fill', 'bi-moisture', 'bi-star-fill',
      'bi-cart-fill', 'bi-bag-fill', 'bi-box-seam', 'bi-gift-fill',
      'bi-bicycle', 'bi-book-fill', 'bi-brush-fill', 'bi-camera-fill',
      'bi-flower1', 'bi-laptop', 'bi-lightbulb-fill', 'bi-music-note-beamed'
    ];

    const colors = [
      '#667eea', '#764ba2', '#52c234', '#198754', '#0dcaf0', '#4facfe',
      '#f5576c', '#f093fb', '#ffc107', '#ffd89b', '#19547b', '#6c757d',
      '#e91e63', '#9c27b0', '#3f51b5', '#00bcd4', '#009688', '#ff5722'
    ];

    // Kategorileri yÃ¼kle
    async function loadCategories() {
      try {
        const response = await fetch('category-api.php?action=getCategories');
        const data = await response.json();
        if (data.success) {
          categories = data.data;
          renderCategoryList();
        }
      } catch (error) {
        console.error('Kategori yÃ¼kleme hatasÄ±:', error);
        showAlert('Kategoriler yÃ¼klenemedi!', 'danger');
      }
    }

    // Kategori listesini render et
    function renderCategoryList() {
      const container = document.getElementById('categoryList');
      const countEl = document.getElementById('categoryCount');
      
      container.innerHTML = '';
      countEl.textContent = categories.length;

      if (categories.length === 0) {
        container.innerHTML = `
          <div class="text-center py-5">
            <i class="bi bi-inbox fs-1 text-muted d-block mb-3"></i>
            <p class="text-muted">HenÃ¼z kategori eklenmemiÅŸ</p>
          </div>
        `;
        return;
      }

      categories.forEach((cat, index) => {
        const card = document.createElement('div');
        card.className = `category-card ${selectedCategoryId === cat.id ? 'selected' : ''}`;
        card.innerHTML = `
          <div class="d-flex align-items-center gap-3">
            <div style="width:50px;height:50px;border-radius:12px;background-color:${cat.color};display:flex;align-items:center;justify-content:center">
              <i class="${cat.icon} text-white fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h6 class="mb-1 fw-bold">${cat.name}</h6>
              <small class="text-muted">ID: ${cat.id} â€¢ ${cat.icon}</small>
            </div>
            <div>
              <span class="badge" style="background-color:${cat.color}">
                <i class="${cat.icon}"></i> ${cat.name}
              </span>
            </div>
          </div>
        `;
        card.addEventListener('click', () => selectCategory(cat.id));
        container.appendChild(card);
      });
    }

    // Ä°kon seÃ§icisini oluÅŸtur
    function renderIconPicker() {
      const picker = document.getElementById('iconPicker');
      picker.innerHTML = '';
      icons.forEach(icon => {
        const div = document.createElement('div');
        div.className = 'icon-option';
        div.innerHTML = `<i class="${icon} fs-4"></i>`;
        div.addEventListener('click', () => selectIcon(icon));
        picker.appendChild(div);
      });
    }

    // Renk seÃ§icisini oluÅŸtur
    function renderColorPicker() {
      const picker = document.getElementById('colorPicker');
      picker.innerHTML = '';
      colors.forEach(color => {
        const div = document.createElement('div');
        div.className = 'color-option';
        div.style.backgroundColor = color;
        div.addEventListener('click', () => selectColor(color));
        picker.appendChild(div);
      });
    }

    // Ä°kon seÃ§
    function selectIcon(icon) {
      document.getElementById('categoryIcon').value = icon;
      document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      updatePreview();
    }

    // Renk seÃ§
    function selectColor(color) {
      document.getElementById('categoryColor').value = color;
      document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      updatePreview();
    }

    // Ã–nizleme gÃ¼ncelle
    function updatePreview() {
      const name = document.getElementById('categoryName').value || 'Kategori AdÄ±';
      const icon = document.getElementById('categoryIcon').value;
      const color = document.getElementById('categoryColor').value;
      const badge = document.getElementById('previewBadge');
      badge.style.backgroundColor = color;
      badge.innerHTML = `<i class="${icon}"></i> ${name}`;
    }

    // Kategori seÃ§ (dÃ¼zenleme iÃ§in)
    function selectCategory(id) {
      selectedCategoryId = id;
      const cat = categories.find(c => c.id === id);
      if (!cat) return;

      renderCategoryList();
      
      document.getElementById('formTitle').textContent = 'Kategori DÃ¼zenle';
      document.getElementById('editId').value = cat.id;
      document.getElementById('categoryName').value = cat.name;
      document.getElementById('categoryIcon').value = cat.icon;
      document.getElementById('categoryColor').value = cat.color;
      document.getElementById('deleteBtn').style.display = 'block';
      
      // SeÃ§ili ikonu iÅŸaretle
      document.querySelectorAll('.icon-option').forEach(el => {
        const iconClass = el.querySelector('i').className.split(' ')[0];
        el.classList.toggle('selected', iconClass === cat.icon);
      });
      
      // SeÃ§ili rengi iÅŸaretle
      document.querySelectorAll('.color-option').forEach(el => {
        el.classList.toggle('selected', el.style.backgroundColor === cat.color);
      });
      
      updatePreview();
    }

    // SeÃ§imi iptal et
    function resetForm() {
      selectedCategoryId = null;
      document.getElementById('formTitle').textContent = 'Yeni Kategori Ekle';
      document.getElementById('categoryForm').reset();
      document.getElementById('editId').value = '';
      document.getElementById('categoryIcon').value = 'bi-tag-fill';
      document.getElementById('categoryColor').value = '#667eea';
      document.getElementById('deleteBtn').style.display = 'none';
      
      document.querySelectorAll('.icon-option, .color-option').forEach(el => el.classList.remove('selected'));
      document.querySelector('.icon-option').classList.add('selected');
      document.querySelector('.color-option').classList.add('selected');
      
      updatePreview();
      renderCategoryList();
    }

    // Alert gÃ¶ster
    function showAlert(message, type = 'success') {
      const alertContainer = document.getElementById('alertContainer');
      const alertEl = document.createElement('div');
      alertEl.className = `alert alert-${type} alert-dismissible fade show`;
      alertEl.innerHTML = `
        <i class="bi ${type === 'success' ? 'bi-check-circle-fill' : 'bi-x-circle-fill'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      alertContainer.appendChild(alertEl);
      setTimeout(() => alertEl.remove(), 5000);
    }

    // Form submit
    document.getElementById('categoryForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const id = document.getElementById('editId').value;
      const isEdit = !!id;
      
      const category = {
        name: document.getElementById('categoryName').value.trim(),
        icon: document.getElementById('categoryIcon').value,
        color: document.getElementById('categoryColor').value
      };

      if (isEdit) category.id = parseInt(id);

      try {
        const action = isEdit ? 'updateCategory' : 'addCategory';
        const response = await fetch(`category-api.php?action=${action}`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(category)
        });

        const result = await response.json();
        
        if (result.success) {
          showAlert(result.message, 'success');
          await loadCategories();
          if (!isEdit) resetForm();
        } else {
          throw new Error(result.message);
        }
      } catch (error) {
        showAlert('âŒ Hata: ' + error.message, 'danger');
      }
    });

    // Silme
    document.getElementById('deleteBtn').addEventListener('click', async function() {
      const id = document.getElementById('editId').value;
      const cat = categories.find(c => c.id == id);
      
      if (!confirm(`"${cat.name}" kategorisini silmek istediÄŸinizden emin misiniz?`)) return;

      try {
        const response = await fetch(`category-api.php?action=deleteCategory&id=${id}`);
        const result = await response.json();
        
        if (result.success) {
          showAlert(result.message, 'success');
          await loadCategories();
          resetForm();
        } else {
          throw new Error(result.message);
        }
      } catch (error) {
        showAlert('âŒ Hata: ' + error.message, 'danger');
      }
    });

    // Ä°ptal
    document.getElementById('cancelBtn').addEventListener('click', resetForm);

    // Ä°sim deÄŸiÅŸince Ã¶nizleme gÃ¼ncelle
    document.getElementById('categoryName').addEventListener('input', updatePreview);

    // Sayfa yÃ¼klendiÄŸinde
    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      renderIconPicker();
      renderColorPicker();
      document.querySelectorAll('.icon-option')[0].classList.add('selected');
      document.querySelectorAll('.color-option')[0].classList.add('selected');
      console.log('%cðŸ“š Kategori YÃ¶netimi - PHP API ile Ã§alÄ±ÅŸÄ±yor', 'color: #4facfe; font-size: 18px; font-weight: bold;');
    });
  </script>
</body>
</html>
